const synthetics = require('Synthetics');
const log = require('SyntheticsLogger');
const AWS = require('aws-sdk');

const synConfig = synthetics.getConfiguration();

synConfig.setConfig({
    screenshotOnStepStart: true,
    screenshotOnStepSuccess: true,
    screenshotOnStepFailure: true
});

const frontEndLoad = async () => {
    log.info('Starting frontend canary.');
    const page = await synthetics.getPage();
    const response = await page.goto('foss.photography', {
        waitUntil: 'domcontentloaded',
        timeout: 30000
    });

    if (!response) {
        await synthetics.takeScreenshot('failed', 'load');
        throw 'Failed to load frontend, website is down';
    }
}

exports.handler = async () => {
    return await frontEndLoad();
}